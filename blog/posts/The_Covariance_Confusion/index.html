<!DOCTYPE html>
<html>
  <head>
    <!-- Standard Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <link rel="shortcut icon" type="image/jpeg" href="../../../assets/images/logo.png" />
    <!-- Site Properities -->
    <meta name="generator" content="DocPad v6.78.4" />
    <title> Athitya Kumar | The Covariance Confusion </title>
    <meta name="description" content="Despite our very best efforts to remain aware and concentrated, we do come across times when we're confused with a very small issue and then later feel silly about the same. Here's a geek rant about a silly confusion that I experienced, a few months back." />
    <meta name="keywords" content="athitya,kumar,iit,iitkgp,developer,open,source,coder,programmer,mechanical,engineering,chess,carnatic,vocalist,tv,series,blog,Despite,our,very,best,efforts,to,remain,aware,and,concentrated,,we,do,come,across,times,when,we're,confused,with,a,very,small,issue,and,then,later,feel,silly,about,the,same.,Here's,a,geek,rant,about,a,silly,confusion,that,I,experienced,,a,few,months,back." />
    <meta property="og:title" content="The Covariance Confusion" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://athityakumar.github.io/blog/posts/The_Covariance_Confusion/" />
    <meta property="og:image" content="https://athityakumar.github.io/assets/images/blog/The_Covariance_Confusion/auv.jpg" />
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta property="og:description" content="Despite our very best efforts to remain aware and concentrated, we do come across times when we're confused with a very small issue and then later feel silly about the same. Here's a geek rant about a silly confusion that I experienced, a few months back." />
    <link rel="stylesheet" type="text/css" class="ui" href="../../../assets/all.css">
  </head>
  <body id="example" class="index" ontouchstart="">
    <!-- laptop display -->
    <div class="following bar">
      <div class="ui container">
        <div class="ui large inverted secondary network menu">
          <div class="item">
            <div class="ui logo shape">
              <div class="sides">
                <div class="active ui side">
                  <a href="../../../"> @athityakumar </a>
                </div>
              </div>
            </div>
          </div>
          <div class="right menu">
            <div class="item" style="color: white;">
              &nbsp;  
              
              <div class="ui breadcrumb">
                <div class="post_search">
                  <div class="ui fluid search">
                    <div class="ui icon input">
                      <input class="prompt" type="text" placeholder="Search posts.">
                      <i class="search icon"></i>
                    </div>
                    <div class="results"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Mobile display -->
  <div class="ui fixed inverted main menu">
    <div class="ui container">
      <div class="item" style="color: white;">
        &nbsp;  
        
        
        <div class="ui breadcrumb">
          <a href="../../../" class="section" style="color: white;">@athityakumar</a>
        </div>
      </div>
      <div class="right item" style="color: white;">
        &nbsp;  
        
        
        <div class="ui breadcrumb">
          <div class="post_search">
            <div class="ui right aligned search">
              <div class="ui icon input">
                <input class="prompt" type="text" placeholder="Search posts.">
                <i class="search icon"></i>
              </div>
              <div class="results"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="pusher">
  <div class="full height">
    <div class="zoomed masthead segment">
      <div class="ui container">
        <div class="introduction">
          <h1 class="ui inverted header">
            <span class="tagline">
              The Covariance Confusion  
        </span>
          </h1>
          <h4 class="tagline">  You're here : <a href="../../../">Homepage</a> > <a href="../../page1/">Blog</a> > <a>This Blog Post</a>
          </h4>
          <div class="ui hidden divider"></div>
          <div class="ui hidden divider"></div>
          <a href="#go" class="ui labeled primary icon button">
            <i class="angle double down large icon"></i> &nbsp; Read this post
      </a>
          <!-- <a href="resume.html" class="ui labeled primary icon button">
        <i class="file pdf outline large icon"></i> View Resume
      </a> -->
        </div>
      </div>
    </div>
    <div id="go" class="ui vertical stripe intro segment">
      <div class="ui stackable very relaxed grid container">
        <div class="row">
          <div class="sixteen wide column center aligned">
            <div class="ui hidden divider"></div>
            <h2 class="ui title"> The Covariance Confusion</h2>
            <p class="ui description">Posted on 07/01/2017 at 2:00 PM by <a href="../../../">The Vibe</a>.</p>
            <p>
              <a href="../../tags/team_auv/page1/" class="ui red tag label"> TEAM AUV </a>
              <a href="../../tags/iit_kharagpur/page1/" class="ui violet tag label"> IIT Kharagpur </a>
              <a href="../../tags/software/page1/" class="ui brown tag label"> Software </a>
              <a href="../../tags/development/page1/" class="ui brown tag label"> Development </a>
              <a href="../../tags/rant/page1/" class="ui green tag label"> Rant </a>
              <a href="../../tags/python/page1/" class="ui blue tag label"> Python </a>
            </p>
          </div>
        </div>
      </div>
      <div class='stackable very relaxed ui grid container fakeload'>
        <div class='row'>
          <div class="twelve wide column">
            <p> <span style='display:block; float:left; font-size: 200%;  color:#ffffff; margin-top:5px; margin-right:8px; padding: 10px 20px 10px 20px; text-align:center; background-color: #000;'>D</span>espite our very best efforts to remain aware and concentrated, we do come across times when we're confused with a very small issue and then later feel silly about the same. Here's a geek-rant about a silly confusion that I experienced, a few months back. </p>
            <br>
            <div class='ui horizontal divider'>THE BACKGROUND</div>
             
            <p> <a href='https://auviitkgp.github.io/' target='_blank'> Team Autonomous Underwater Vehicle (AUV) </a> is a Research group of <a href='https://en.wikipedia.org/wiki/Indian_Institute_of_Technology_Kharagpur' target='_blank'> IIT Kharagpur </a> that focuses on making full-fledged autonomous underwater bots. Making such an autonomous bot requires skill-set in fields like Image Processing, GUI for simulator, Controls system, Battery management system, Hardware design, etc. For integrating these different fields and sensors to work with one another, we at Team AUV use <a href='https://en.wikipedia.org/wiki/Robot_Operating_System' target='_blank'> Robot Operating System (ROS) </a>. As a Software Team Member of Team AUV, I was given the task of updating our existing <a href='https://www.spartonnavex.com/product-category/inertial-sensors/?post_type=product' target='_blank'> Sparton sensor </a> - ie, I had to change the existing <code style='font-size: 13px;'>IMU</code> message types and make the python script to read the message(s) from ROS parameters called <code style='font-size: 13px;'>ROSPARAMS</code>. </p>
            <br>
            <div class='ui horizontal divider'>THE CONFUSION EPISODE</div>
            <p> The <a href='https://github.com/auviitkgp/kraken_3.0/blob/indigo-devel/sensor_stack/sparton/src/sparton.py' target='_blank'> Sparton sensor's script </a> in general deals with mechanical aspects - like <code style='font-size: 13px;'>roll</code>, <code style='font-size: 13px;'>pitch</code>, <code style='font-size: 13px;'>yaw</code>, <code style='font-size: 13px;'>quaternion</code>, etc. As a measure of how much stable the readings of the sensor would be in the working conditions, there are covariance matrices for <code style='font-size: 13px;'>linear acceleration</code>, <code style='font-size: 13px;'>orientation</code> and <code style='font-size: 13px;'>angular velocity</code>. While porting the new sensor script, I saw these covariance matrices that had to be found - and as I wasn't sure about the procedure to find out their values, I started a discussion on channel <code style='font-size: 13px;'>#software</code> of our slack group. What unfolded next, in an interval of half an hour was this discussion below between me, <a href='https://github.com/pranaypratyush' target='_blank'> Pranay Pratyush </a> and <a href='https://github.com/icyflame' target='_blank'> Siddharth Kannan </a>. Read our discussion below, to find out how we understood about the required covariance, in quite an anti-climatic plot-twist manner. 
              <h4>
                <div class='ui message'>
                  <p>Athitya : So, do we really need 3 more vectors that store the set of say, linear acceleration values (like cumulatively appending to the list) corresponding to each vector? </p>
                   
                  <p>Pranay : Cumulatively appending? Why? </p>
                   
                  <p>Athitya : Yep. How else would covariance exist if the  <code>< acc_x acc_y,acc_z ></code> are just values and not a list of values / random vectors? </p>
                     
                    <p>Pranay : Ah, yes. I got confused with some other covariance. Yeah, you need to maintain a history of covariances. </p>
                     
                    <p>Athitya : Currently, the rate for the loop is 10Hz or 10 value of <code>acc_x / 1 sec</code>. So, if the bot totally takes 20 mins, we'd end up with totally 12000 values for <code>acc_x</code> alone. 
                      <p> 
                        <p>Siddharth : And are you going to store everything? Shouldn't a representative value of the whole set do? Like an average or something? </p>
                         
                        <p>Athitya : I was thinking of storing <code> n , cov_n , mean_n </code> variables and then, removing the list of <code>acc_x</code> values from 1 to n. So for (n+1)th time , we can calculate like <code> mean_n+1 = (ax,n+1 + n* mean_n) / n+1 </code> </p>
                         
                        <p>Siddharth : Just found the relation that we were looking for. We will have one extra summation term and a few Ns to take care of. But, more or less - this should work. Lemme work on this. And, your point is noted, Pranay. Maybe that is true, but this is worth a shot though. 
                          <p></p>
                           <img src='../../../assets/images/load.png' data-src='../../../assets/images/blog/The_Covariance_Confusion/cov.png'  class='ui big centered image'> <br>
                           </p>
                         
                        <p>Pranay : This would definitely diverge in a short period of time. Trust me. Not worth a shot. This is meant for a small dataset, not for doing it cumulatively. </p>
                         
                        <p>Siddharth : What? This is an identity right? How can this diverge? And they did the calculation for us anyway. We need to store <code> avg_x_n, avg_y_n, cov_n</code> and from that, we can get <code>cov_(n+1)</code>. Tell me if my interpretation is wrong or something. </p>
                         
                        <p>Athitya : Alright, so can I start on implementing this? </p>
                         
                        <p>Siddharth : Hmm, I don't see any inconsistency in this - I think this should work. </p>
                         
                        <p>Pranay : What exactly would be done with the covariance values, Athitya? </p>
                         
                        <p>Athitya : It's a part of the sensor message. </p>
                         <br>
                        <div class='ui horizontal divider'>AND NOW, THE PLOT THICKENS</div>
                        <br>
                         
                        <p>Siddharth : Athitya, I just read the description provided by ROS, which says - <br>
                          <br>
                           <i>If the covariance of the measurement is known, it should be filled in (if all you know is the variance of each measurement, e.g. from the datasheet, just put those along the diagonal). A covariance matrix of all zeros will be interpreted as covariance unknown, and to use the data a covariance will have to be assumed or gotten from some other source.' </i><br>
                          <br>
                          It looks to me like they are saying that we should fill it in if it's a part of the measurement - rather than cumulatively calculating it and populating it there. </p>
                         
                        <p>Athitya : So, if the data on covariance matrix is not given on the sensor's document, we can just initialise these matrices as zero matrices? That was a rather simple solution to a self-assumed complex problem. Duh! </p>
                         
                        <p>Pranay: Wow. We were all way off from what was intended by covariance. This got me confused so badly, I'm going to call it a night. </p>
                         
                        <p>Siddharth : Athitya & Pranay, we did end up learning a thing or two about the mathematical methods of covariance calculation. Right? </p>
                         </div>
                    </h4>
                  </p>
                  <br>
                  <div class='ui horizontal divider'>THE SOLUTION</div>
                  <p> As mentioned by Siddharth, the <a href='http://docs.ros.org/api/sensor_msgs/html/msg/Imu.html' target='_blank'> IMU sensor_msgs documentation by ROS </a> cleared this self-created confusion, and the porting of new message types for sparton sensor was successfully accomplished with <a href='https://github.com/auviitkgp/kraken_3.0/pull/112' target='_blank'> Pull request #112 - Changed msgs format of sparton </a>. Nevertheless, this incident is a sweet memory that the three of us will remember for a long time, unless another dumb confusion crosses our path in a similar fashion to humble our non-existent ego.          </div>
                  <div class="four wide column">
                    <div class="ui fluid centered card">
                      <div class="content">
                        <a class="header ui blue top left attached label">Tags</a>
                        <p class="description">
                          <div class="ui hidden divider"></div>
                          <div class="tag_search">
                            <div class="ui fluid search center aligned">
                              <div class="ui icon input">
                                <input class="prompt" type="text" placeholder="Search tags.">
                                <i class="search icon"></i>
                              </div>
                              <div class="results"></div>
                            </div>
                          </div>
                          <div class="ui hidden divider"></div>
                          <a href="../../tags/team_auv/page1/" class="ui red tag label">TEAM AUV</a>
                          <a href="../../tags/metakgp/page1/" class="ui black tag label">Metakgp</a>
                          <a href="../../tags/iit_kharagpur/page1/" class="ui violet tag label">IIT Kharagpur</a>
                          <a href="../../tags/web/page1/" class="ui brown tag label">Web</a>
                          <a href="../../tags/software/page1/" class="ui brown tag label">Software</a>
                          <a href="../../tags/design/page1/" class="ui brown tag label">Design</a>
                          <a href="../../tags/development/page1/" class="ui brown tag label">Development</a>
                          <a href="../../tags/experience/page1/" class="ui green tag label">Experience</a>
                          <a href="../../tags/rant/page1/" class="ui green tag label">Rant</a>
                          <a href="../../tags/documentation/page1/" class="ui green tag label">Documentation</a>
                          <a href="../../tags/javascript/page1/" class="ui blue tag label">JavaScript</a>
                          <a href="../../tags/python/page1/" class="ui blue tag label">Python</a>
                          <a href="../../tags/ruby/page1/" class="ui blue tag label">Ruby</a>
                          <a href="../../tags/php/page1/" class="ui blue tag label">PHP</a>
                          <a href="../../tags/ruby_on_rails/page1/" class="ui blue tag label">Ruby on Rails</a>
                          <a href="../../tags/c++/page1/" class="ui blue tag label">C++</a>
                          <a href="../../tags/chess/page1/" class="ui orange tag label">Chess</a>
                          <a href="../../tags/music/page1/" class="ui orange tag label">Music</a>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="ui stackable very relaxed grid container">
                <div class="row">
                  <div class="sixteen wide column center aligned">
                    <a href="../Kharagpur_Winter_of_Code_2016/" class="ui labeled primary icon left floated button">
                      <i class="angle double left large icon"></i> &nbsp; Previous post
            </a>
                    <a class="ui right labeled icon right floated button">
                      Next post &nbsp; <i class="angle double right large icon"></i>
                    </a>
                  </div>
                </div>
              </div>
              <div class="ui stackable very relaxed grid container">
                <div class="row">
                  <div class="sixteen wide column center aligned">
                    <div id="disqus_thread"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="ui black inverted vertical footer segment">
            <div class="ui center aligned container">
              <div class="ui stackable inverted grid">
                <div class="sixteen wide right floated column">
                  <h4 class="ui inverted teal header">Built by @athityakumar.</h4>
                </div>
              </div>
            </div>
          </div>
        </div>
        <a href="#" class="scrollToTop"><span class="ui primary icon button"><b><i class="angle double up large icon"></i></b></span></a>
        <script>
          window.less = {
                    async        : true,
                    environment  : 'production',
                    fileAsync    : false,
                    onReady      : false,
                    useFileCache : true
            };
          
          var post_content = [
          
                { url: "../The_Covariance_Confusion/",  post_title: "The Covariance Confusion" },
          
                { url: "../Kharagpur_Winter_of_Code_2016/",  post_title: "Kharagpur Winter of Code 2016" },
                          { url: "../Hello_World/",  post_title: "Hello World" }
                ];
          
          var tag_content = [
          
                { url: "../../tags/team_auv/page1/",  tag_title: "TEAM AUV", color: "red" },
          
                { url: "../../tags/metakgp/page1/",  tag_title: "Metakgp", color: "black" },
          
                { url: "../../tags/iit_kharagpur/page1/",  tag_title: "IIT Kharagpur", color: "violet" },
          
                { url: "../../tags/web/page1/",  tag_title: "Web", color: "brown" },
          
                { url: "../../tags/software/page1/",  tag_title: "Software", color: "brown" },
          
                { url: "../../tags/design/page1/",  tag_title: "Design", color: "brown" },
          
                { url: "../../tags/development/page1/",  tag_title: "Development", color: "brown" },
          
                { url: "../../tags/experience/page1/",  tag_title: "Experience", color: "green" },
          
                { url: "../../tags/rant/page1/",  tag_title: "Rant", color: "green" },
          
                { url: "../../tags/documentation/page1/",  tag_title: "Documentation", color: "green" },
          
                { url: "../../tags/javascript/page1/",  tag_title: "JavaScript", color: "blue" },
          
                { url: "../../tags/python/page1/",  tag_title: "Python", color: "blue" },
          
                { url: "../../tags/ruby/page1/",  tag_title: "Ruby", color: "blue" },
          
                { url: "../../tags/php/page1/",  tag_title: "PHP", color: "blue" },
          
                { url: "../../tags/ruby_on_rails/page1/",  tag_title: "Ruby on Rails", color: "blue" },
          
                { url: "../../tags/c++/page1/",  tag_title: "C++", color: "blue" },
          
                { url: "../../tags/chess/page1/",  tag_title: "Chess", color: "orange" },
                          { url: "../../tags/music/page1/",  tag_title: "Music", color: "orange" }
                ];
        </script>
        <script src="../../../assets/all.js"></script>
        <script>
          /**
              *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
              *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
          
              var disqus_config = function () {
              this.page.url = "http://athityakumar.github.io/blog/posts/The_Covariance_Confusion/index.html";  // Replace PAGE_URL with your page's canonical URL variable
              this.page.identifier = "faxwmebvilgurhqksjczyopndt"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable */
              };
          
              (function() { // DON'T EDIT BELOW THIS LINE
              var d = document, s = d.createElement('script');
              s.src = 'https://athityakumar-github-io.disqus.com/embed.js';
              s.setAttribute('data-timestamp', +new Date());
              (d.head || d.body).appendChild(s);
              })();
        </script>
      </body>
    </html>